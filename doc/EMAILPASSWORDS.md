# Email Password Management

We don't want to manage user passwords for users, but Mastodon is built around the server managing the user's
credentials.
We reconcile our desire to get out password management and still fit into Mastodon's authentication flow, by requiring
users to start registration by email **before** registering with the app.
We then generate secrets on the user's behalf and send them the secret over email.
So yes, we manage passwords, but they are not generated by users and instead are randomly generated whenever we need a
secret.

## Mail flow

First, the user registers via email by sending an email with a subject of "register me" to moth@*servername*, where
*servername* is the hostname of the moth server.
Currently, any name @*servername* will work, but that will probably change in the future.
Also, the subject only needs to have the substring "regist" to initiate registration.
To avoid generating email storms, moth will not reply to emails that are a reply.

Second, the server will generate a random base64 encoded password and send it in response to the registration request
email.
This email and password will be added to the **emailregistration** collection.

Finally, the user will register using the Mastodon app, but rather than choosing a password, the user will enter the
password they received via email.

## Password reset

Users don't need their password very often since the apps keep the user logged in, but if they need to recover their
password, they email to moth@*servername* with the subject "reset password".
As long as the substring **reset** is in the subject, a reset will be trigger.
The user will receive an email with the new password.

# Email Password Management without email

Email accounts and passwords can be managed directly if email has not been set up.
This is especially helpful in a development environment.

**moth-client.jar** has commands to list email registration and create and update registrations from the commandline.